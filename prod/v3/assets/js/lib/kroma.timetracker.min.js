var OPTIONS={FORMAT:"json",METHOD:"post",SERVER:"http://kromaviews.no:8080/dev/games/bama/srv/kroma.timetracker.php",TIMER_INTERVAL:1e3,REPORT_INTERVAL:15,IDLE_TIMEOUT:60},CLIENT={url:window.location,event:"unknown",timestamp:0,description:""};VGTouchTimeTracker=function(e){var t={__console:document.getElementById("console")||!1,_options:{},_timer:!1,SESSION:{start:(new Date).getTime(),initialized:!1,EVENTS:[],IS_IDLE:!1,IS_VISIBLE:!0,TIME:{total:0,idle:0,active:0,visible:0,hidden:0}}};return t.__onWindowMessage=function(e){VGTouchTimeTracker.log(e.origin+" posted message: "+e.data)},t.__onIdleStart=function(){VGTouchTimeTracker.SESSION.IS_IDLE=!0},t.__onIdleEnd=function(){VGTouchTimeTracker.SESSION.IS_IDLE=!1},t.__onVisible=function(){VGTouchTimeTracker.SESSION.IS_VISIBLE=!0},t.__onHidden=function(){VGTouchTimeTracker.SESSION.IS_VISIBLE=!1},t.__onTimer=function(){var e=VGTouchTimeTracker||!1;return e?(0===e.SESSION.TIME.active%e._options.REPORT_INTERVAL&&(console.log("Tracking active time: "+e.SESSION.TIME.active+"/"+e.SESSION.TIME.total+" sec"),e.update()),e.SESSION.TIME.total++,e.SESSION.IS_VISIBLE?e.SESSION.TIME.visible++:e.SESSION.TIME.hidden++,e.SESSION.IS_IDLE?e.SESSION.TIME.idle++:e.SESSION.TIME.active++,void 0):(console.log("No TimeTracker object!"),void 0)},t.__init=function(e){var t="";if(this.SESSION.initialized===!0)return console.log("Trying to __init() tracker object, but it is already initialized. This should never happen."),!1;this.SESSION.info={animationMethod:this.getAnimationMethod(),url:window.location},document.addEventListener("message",this.__onWindowMessage,!1),document.addEventListener("focus",this.__onVisible,!1),document.addEventListener("blur",this.__onHidden,!1),t="mousedown keydown","ontouchstart"in window&&(t+=" "+touchstart),window.addEventListener(t,this.onActivity,!1);for(var n in e)this._options[n]=e[n];return this._img=new Image,this.SESSION.initialized=!0,!0},t._sendJSON=function(e){var t=new XMLHttpRequest,n=JSON.stringify(e);return 0===e.length?(console.log("NOT sending empty data object to logging server."),!1):(t.onload=this._onResponse,t.open("POST",this._options.SERVER,!0),t.setRequestHeader("Content-type","application/json; charset=utf-8"),t.setRequestHeader("Content-length",n.length),t.setRequestHeader("Connection","close"),t.send(n),void 0)},t._sessionTime=function(){return this.START_SESSION-(new Date).getTime()},t._sendREQUEST=function(e){var t=this._encodeAsGet(e);console.log("Sending GET request: "+this._options.SERVER+"?"+t),this._img.src=this._options.SERVER+"?"+t},t._send=function(e,t){var t=t||this._options.METHOD;if("object"!=typeof e)return console.log("Wrong parameter type '"+typeof e+"', expected 'object'."),!1;if(0===e.length)return console.log("NOT sending empty data object to logging server."),!1;switch(t.toLowerCase()){case"json":this._sendJSON(e);break;case"get":this._sendREQUEST(e);break;default:this._sendJSON(e)}},t._onResponse=function(e){if(4==this.readyState){if(200!=this.status&&304!=this.status)return t.log("HTTP error: "+this.status+" - "+this.statusText),void 0;try{var n=JSON.parse(this.responseText);1==n.OK||console.log("Error-response received from logger service: "+this.status+"; OK: "+n.OK,n)}catch(e){console.log("Error: ",e)}}},t._onError=function(e){var t="string"==typeof e.message?e.message:!1;t&&(t+="\n"+e.fileName||"",t+=":",t+=e.lineNumber||"",t+=" - "),DEBUG&&(t+=VGTouchTimeTracker.stacktrace(e)),this.error(t,e)},t._logToConsole=function(e,t){return this.__console?(console.log("console.nodeName: "+this.__console.nodeName),console.log("console.nodeType: "+this.__console.nodeType),this.__console.value+=e+("undefined"!==t?JSON.stringify(t):"")):console.log("No __console element!"),window.console?void 0:(t?console.log(e,t):console.log(e),!0)},t.getAnimationMethod=function(){var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)};return e.name||"window.setTimeout"},t.setVisible=function(e){var e=e||!0;this.IS_VISIBLE!==e&&(this.IS_VISIBLE=e),this.IS_VISIBLE||(VGTouchTimeTracker.SESSION.IS_IDLE=!0)},t.onActivity=function(e){var t=VGTouchTimeTracker,n=t.PREV_EVENT||(new Date).getTime();t.PREV_EVENT=(new Date).getTime(),t.PREV_EVENT-n>1e3*t.IDLE_TIMEOUT&&t.__onIdleEnd(e)},t.setSessionVariable=function(e,t,n){var n="string"==typeof n&&n.length>0?n:!1;n?(this.SESSION[n]||(this.SESSION[n]={}),this.SESSION[n][e]=t):this.SESSION[e]=t},t.error=function(e,t){this._send({event:"error",message:e,data:t||!1})},t.log=function(e,t){this._send({event:"log",message:e,data:t||!1})},t.send=function(e,t){var t=t||"data";this._send({event:t,data:e||null})},t.update=function(){this.send(this.SESSION,"time")},t.stacktrace=function(e){return e.stack||"No stack trace available."},t.run=function(e){var e=e||1e3;this._timer!==!1&&(console.log("clearing interval: "+this._timer),clearInterval(this._timer),this._timer=!1),this._timer=setInterval(this.__onTimer,e)},window.onerror=this._onError,console.log("Starting VGTouchTimeTracker."),t.__init(e),t}(OPTIONS);